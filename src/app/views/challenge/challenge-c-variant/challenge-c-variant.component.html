<ng-container *ngIf="challengeState$ | async as state">
  <app-challenge-finished-overlay
    *ngIf="state.challengeFinished"
    [result]="state.correctAnswersRatio"
  ></app-challenge-finished-overlay>

  <app-show-answer-overlay
    *ngIf="state.showAnswer"
    (click)="nextWord()"
  ></app-show-answer-overlay>

  <div class="middle-container">
    <app-history-back-button
      *ngIf="history.length && historyCurrentWordIndex !== 0"
      (click)="backInHistory()"
    ></app-history-back-button>

    <app-history-forward-button
      *ngIf="showHistory"
      (click)="forwardInHistory()"
    ></app-history-forward-button>

    <app-v-c-middle-section
      [variant]="variant"
      [gapNumber]="state.gapNumber"
      [showHistory]="showHistory"
      [word]="showHistory ? historyCurrentWord : state.currentWord"
      [showAnswer]="showHistory ? true : state.showAnswer"
      [lastAnswerCorrect]="
        showHistory ? historyCurrentWord.answerCorrect : state.lastAnswerCorrect
      "
    >
    </app-v-c-middle-section>
  </div>

  <app-v-c-bottom-section
    [variant]="variant"
    [class.hide]="showHistory"
    [gapNumber]="state.gapNumber"
    [roundWords]="state.currentWordAnswers"
    (action)="handleAnswer($event)"
  >
  </app-v-c-bottom-section>

  <app-challenge-progress
    [currentStep]="
      showHistory ? historyCurrentWordIndex + 1 : state.currentSequenceStep + 1
    "
  ></app-challenge-progress>
</ng-container>
